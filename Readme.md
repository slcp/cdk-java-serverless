# AWS CDK Java Example

The purpose of this repository is learn and surface that learning when getting started with Java in AWS using CDK and serverless infrastructure like Lambda & DynamoDB.

## Potentially useful resources

  - [https://docs.aws.amazon.com/cdk/v2/guide/work-with-cdk-java.html](https://docs.aws.amazon.com/cdk/v2/guide/work-with-cdk-java.html)
  - [https://blog.tericcabrel.com/aws-lambda-java-cdk/](https://blog.tericcabrel.com/aws-lambda-java-cdk/)
  - [https://maven.apache.org/plugins/maven-shade-plugin/](https://maven.apache.org/plugins/maven-shade-plugin/)
  - [https://www.baeldung.com/maven-multi-module](https://www.baeldung.com/maven-multi-module)
  - [https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/dynamodb-enhanced-client.html](https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/dynamodb-enhanced-client.html)


## Requirements

  - Latest CDK - [Install](https://docs.aws.amazon.com/cdk/v2/guide/getting_started.html#getting_started_install)
  - Java 17 - I used `brew` to [install](https://formulae.brew.sh/formula/openjdk@17) and use [`jenv`](https://www.jenv.be/) to manage multiple versions
  - An IDE that support Java development, I am using VSCode but the one you are most comfortable with is probably best
  - An AWS Account, if you are an A Cloud Guru user I recommend using their ephemeral AWS Sandboxes for learning and test deployments though any AWS account is fine.
  - (optional) `aws-vault` - [Install](https://github.com/99designs/aws-vault). The commands in the `Makefile` used `aws-vault` with a profile of `sandbox` to execute commands against an AWS account. If you are not using `aws-vault` find and remove all instances of `aws-vault exec sandbox --no-session -- ` in the `Makefile` and all other instructions here should work as expected.

## Goals

  - Define a Java Lambda handler
  - Define a Java Lambda in CDK
  - Connect an API Gateway to the Java Lambda
  - Deploy and interact with other services from the Lambda, e.g. DynamoDB
  - Deploy a Lambda Layer with some shared libraries
  - Explore Spring Cloud Functions as a pathway to a Lambda

## Structure

This project has started using a Maven multi-module approach to achieve the goal of developing parts of the application separately (e.g. Lambdas, a Layer) whilst also sharing some dependencies and code. This is an experiment as I have little experience with Maven and little experience using Java in this context where multiple lambdas and other entities may be desired.

All modules are built by default when `make deploy` is run or the parent module (`lambda-application`) is built. The parent module does not produce any output itself whilst the child modules are built as a Jar or according to any local configuration within the child module.

### infra

This is a standalone Java project generated by the CDK CLI using the Java template.

### lambda-application

This is a Maven multi-module project.

  - `pom.xml` - this is the parent POM file that every child module inherits from

#### lambda-1

This is a maven child module of `lambda-application`

  - `pom.xml` - module specific, unshared dependencies or attribute definitions (e.g. version)
    - Where a dependency is another, local child module the `scope` is set as `provided` to ensure that it does not get packaged into the fat Jar produced by the Maven Shade Plugin.

#### lambda-foundation-layer

This is a maven child module of `lambda-application`

  - `pom.xml` - module specific, unshared dependencies or attribute definitions (e.g. version)
    - Where a dependency is another, local child module the `scope` is set as `provided` to ensure that it does not get packaged into the fat Jar produced by the Maven Shade Plugin.

## Deployment

In the early stages of development Localstack was used before access to an AWS account was available, for local deployments this is still supported but deployment to an actual AWS account is now the preferred method of proving out the application.

### AWS

  - Run `make deploy`